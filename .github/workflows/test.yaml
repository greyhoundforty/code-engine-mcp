name: Connect to Tailscale Network

on:
  workflow_dispatch:  # Manual trigger for testing
  # You can add other triggers later (push, etc.)

jobs:
  connect-to-tailnet:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          tags: tag:github-actions
          hostname: github-actions-runner

      - name: Test Tailscale Connection
        run: |
          # Display Tailscale IP
          echo "My Tailscale IP is: $(tailscale ip -4)"

          # Ping your webhook server to test connectivity
          ping -c 4 100.70.24.24

          # Test webhook (replace with your actual webhook endpoint)
          curl -X POST \
            http://100.70.24.24:8000/deploy \
            -H "Content-Type: application/json" \
            -d '{"test": "connectivity", "source": "github-actions"}'

          # Keep Tailscale connection active for a bit to see logs
          sleep 10
